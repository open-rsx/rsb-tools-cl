<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8"/>

    <title>RSB Web: Introspection</title>

    <link rel="stylesheet" type="text/css" href="base.css"/>
  </head>

  <body>

    <header>
      <nav class="navbar navbar-inverse" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <a class="navbar-brand" href="https://code.cor-lab.org/projects/rsb">
              <img alt="Brand" src="/images/logo.png"/>
            </a>
          </div>
          <div class="collapse navbar-collapse">
            <div class="nav navbar-nav">
              <ol id="breadcrumbs"></ol>
            </div>
            <div id="refresh" class="navbar-form navbar-right"></div>
            <form id="global-search" class="navbar-form navbar-right" role="search">
          </div>
        </div>
      </nav>
    </header>

    <main class="container-fluid">
      <div class="row">
        <div id="col-main" class="col-md-8">
          <div class="panel panel-default">
            <div class="panel-heading"><h2 class="panel-title">Participant Details</h2></div>
            <div class="panel-body">
              <table id="participant-details"></table>
            </div>
          </div>
        </div>

        <div id="col-graph" class="col-md-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h2 class="panel-title">
                Overview
              </h2>
            </div>
            <div id="graph" class="panel-body">
              <em>coming soonâ„¢</em>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      Generated by <a href="https://code.cor-lab.org/projects/rsb">RSB</a> web
      |
      <a href="/hack.html">Modify this web interface</a>
    </footer>

    <script type="text/javascript" src="../lib/jquery-2.1.3/jquery.min.js"></script>

    <script type="text/javascript" src="../lib/bootstrap-3.3.5/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="Introspection.js"></script>
    <script type="text/javascript" src="introspection.js"></script>
    <script type="text/javascript" src="BreadcrumbsWidget.js"></script>
    <script type="text/javascript" src="SearchWidget.js"></script>
    <script type="text/javascript" src="RefreshWidget.js"></script>
    <script type="text/javascript" src="DetailsWidget.js"></script>

    <script type="text/javascript">
      var introspection = new Introspection();
      var breadcrumbs   = new BreadcrumbsWidget(introspection, $('#breadcrumbs'),
                                                { level: 'participant' });
      var search        = new GlobalSearchWidget(introspection, $('#global-search'));
      var refreshTODO   = new RefreshWidget(introspection, $('#refresh'));

      var details       = new DetailsWidget($('#participant-details'),
                                            participantDetailSpecs);

      var participantId;

      var timer;

      function updateDetails(participant) {
      }

      function update(data, participantId) {
          var context     = findParticipant(data, participantId);
          if (!context) return false;
          var participant = context.participant;

          context.level        = 'participant';
          context.hosts        = data.children;
          context.processes    = context.host.children;
          context.participants = context.process.children;
          breadcrumbs.refresh(context);

          details.refresh(participant);
          updateDetails(participant);

          return true;
      }

      function refresh(newParticipantId) {
          if (timer) clearTimeout(timer);

          participantId = newParticipantId || participantId || getURLParameter('participantId');
          introspection.get().done(function (data) {
              if (update(data, participantId))
                  timer = setTimeout(refresh, 10000);
              else
                  showMessage('Participant ' + participantId + ' no longer exists');
          });
      }

      $(function () {
          refresh();
      });
    </script>

  </body>
</html>
