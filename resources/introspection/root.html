<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8"/>

    <title>RSB Web: Introspection</title>

    <link rel="stylesheet" type="text/css" href="base.css"/>
  </head>

  <body>

    <header>
      <nav class="navbar navbar-inverse" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <span class="navbar-brand">
              <img alt="Brand" src="/images/logo.png"/>
            </span>
          </div>
          <div class="collapse navbar-collapse">
            <div class="nav navbar-nav">
              <ol id="breadcrumbs"></ol>
            </div>
            <div id="refresh" class="navbar-form navbar-right"></div>
            <form id="global-search" class="navbar-form navbar-right" role="search">
            </form>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-fluid">
      <div class="row">
        <div id="col-main" class="col-md-8">
          <div class="panel panel-default">
            <div class="panel-heading"><h2 class="panel-title">Summary</h2></div>
            <div id="summary" class="panel-body">
              <div class="container-fluid">
                <div class="row">
                  <div id="col-main" class="col-md-6">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h2 class="panel-title">
                          Hosts
                          <span id="host-count" class="badge"></span>
                        </h2>
                      </div>
                      <div id="host-list" class="panel-body"></div>
                    </div>
                  </div>
                  <div id="col-main" class="col-md-6">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h2 class="panel-title">
                          Processes
                          <span id="process-count" class="badge"></span>
                        </h2>
                      </div>
                      <div id="process-list" class="panel-body"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="col-graph" class="col-md-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h2 class="panel-title">
                Overview
              </h2>
            </div>
            <div id="graph" class="panel-body">
              <em>coming soonâ„¢</em>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      Generated by <a href="https://code.cor-lab.org/projects/rsb">RSB</a> web
      |
      <a href="/hack.html">Modify this web interface</a>
    </footer>

    <script type="text/javascript" src="../lib/jquery-2.1.3/jquery.min.js"></script>

    <script type="text/javascript" src="Introspection.js"></script>
    <script type="text/javascript" src="introspection.js"></script>
    <script type="text/javascript" src="BreadcrumbsWidget.js"></script>
    <script type="text/javascript" src="SearchWidget.js"></script>
    <script type="text/javascript" src="RefreshWidget.js"></script>

    <script type="text/javascript">
      var introspection = new Introspection();
      var breadcrumbs   = new BreadcrumbsWidget(introspection, $('#breadcrumbs'),
                                                { level: 'introspection' });
      var search        = new GlobalSearchWidget(introspection, $('#global-search'));
      var refreshTODO   = new RefreshWidget(introspection, $('#refresh'));

      var timer;

      function refresh() {
          if (timer) clearTimeout(timer);

          function refreshBlock(query, listElement, countElement) {
              showRunning(listElement, countElement);
              introspection.search('query=' + query)
                  .done(function(result) {
                      showResults(listElement, countElement, null, result,
                                  { max: 20, flat: true });
                  })
                  .fail(function(message) {
                      showError(listElement, countElement, message);
                  });
          }

          refreshBlock('children/host',                  $('#host-list'),    $('#host-count'));
          refreshBlock('children/host/children/process', $('#process-list'), $('#process-count'));

          timer = setTimeout(refresh, 10000);
      }

      $(function () {
          refresh();
      });
    </script>

  </body>
</html>
